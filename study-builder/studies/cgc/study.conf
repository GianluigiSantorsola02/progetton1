{
  "tenant": {
    "domain": ${auth0.domain},
    "mgmtClientId": ${auth0.mgmtClientId},
    "mgmtSecret": ${auth0.mgmtSecret}
  },

  "umbrella": {
    "name": "cgc",
    "guid": "cgc"
  },

  "study": {
    "name": "cgc",
    "guid": "cgc",
    "studyEmail": "cancergenomecollective@broadinstitute.org",
    "baseWebUrl": ${baseWebUrl},
    "irbPassword": ${irbPassword},
    "plusCodePrecision": "MEDIUM",
    "shareParticipantLocation": true
  },

  "supportedLanguages": [
    {
      "language": "en",
      "name": "English",
      "isDefault": true
    }
  ],

  "statistics": [],

  "client": {
    "name": "cgc-angular-client",
    "id": ${auth0.clientId},
    "secret": ${auth0.clientSecret},
    "passwordRedirectUrl": ${passwordRedirectUrl}
  },

  "adminUser": {
    "guid": "PEPPERCGCADMINUSER"
  },

  "studyDetails": [],

  "sendgrid": {
    "apiKey": ${sendgridApiKey},
    "fromName": ${sendgridFromName},
    "fromEmail": ${sendgridFromEmail},
    "defaultSalutation": ${sendgridDefaultSalutation}
  },

  include required("sendgrid-emails.conf"),

  "kits": [],

  "activities": [
    {
      "filepath": "prequal.conf",
      "mappings": [],
      "validations": []
    },
    {
      "filepath": "consent.conf",
      "mappings": [],
      "validations": []
    },
    {
      "filepath": "medical-history.conf",
      "mappings": [],
      "validations": []
    },
    {
      "filepath": "release-request-clinical.conf",
      "mappings": [],
      "validations": []
    },
    {
      "filepath": "release-request-genetic.conf",
      "mappings": [],
      "validations": []
    }
  ],

  "activityTimestamp": "2015-01-01T00:00:00Z",

  "activityStatusIcons": [],

  "pdfs": [],

  "workflowTransitions": [
    # main study workflow
    {
      "from": {
        "type": "START"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "PREQUAL",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": "PREQUAL"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "CONSENT",
          "expression": """
            user.studies["cgc"].forms["PREQUAL"].questions["PREQUAL_SELF_DESCRIBE"].answers.hasOption("DIAGNOSED")
            && user.studies["cgc"].forms["PREQUAL"].questions["PREQUAL_SELF_DESCRIBE"].answers.hasOption("SELF_CURRENT_AGE")
            && user.studies["cgc"].forms["PREQUAL"].questions["PREQUAL_SELF_DESCRIBE"].answers.hasOption("SELF_COUNTRY")
            && user.studies["cgc"].forms["PREQUAL"].questions["PREQUAL_SELF_DESCRIBE"].answers.hasOption("AGREEMENT")
          """
        },
        {
          "type": "MAILING_LIST",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "RETURN_USER"
      },
      "to": [
        {
          "type": "DASHBOARD",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "DASHBOARD"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "CONSENT",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY"
        "activityCode": "CONSENT",
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "MEDICAL_HISTORY",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": "MEDICAL_HISTORY"
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "RELEASE_REQUEST_CLINICAL",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY"
        "activityCode": "RELEASE_REQUEST_CLINICAL",
      },
      "to": [
        {
          "type": "ACTIVITY",
          "activityCode": "RELEASE_REQUEST_GENETIC",
          "expression": "true"
        }
      ]
    },
    {
      "from": {
        "type": "ACTIVITY",
        "activityCode": "RELEASE_REQUEST_GENETIC"
      },
      "to": [
        {
          "type": "DASHBOARD",
          "expression": "true"
        }
      ]
    }
  ],

  "events": [
    # activity instance creation events
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "PREQUAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT"
      },
      "preconditionExpr": "true",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "MEDICAL_HISTORY"
      },
      "preconditionExpr": "true",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "MEDICAL_HISTORY",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "RELEASE_REQUEST_CLINICAL"
      },
      "preconditionExpr": "true",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "RELEASE_REQUEST_CLINICAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "RELEASE_REQUEST_GENETIC"
      },
      "preconditionExpr": "true",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },

    // email events
    {
      "trigger": {
        "type": "USER_REGISTERED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.welcome},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": null,
      "dispatchToHousekeeping": true,
      "order": 1
    }
  ]
}
