{
  "events": [
    {
      "trigger": {
        "type": "USER_REGISTERED"
      },
      "action": {
        "type": "SENDGRID_EMAIL",
        "templates": [
          {
            "emailTemplate": ${emails.welcome},
            "language": "en",
            "isDynamic": false
          }
        ],
        "pdfAttachments": []
      },
      "cancelExpr": null,
      "dispatchToHousekeeping": true,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ADD_PARTICIPANT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_SELF"
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT"].questions["WHO_ENROLLING"].answers.hasOption("ENROLLING_MYSELF")""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "ADD_PARTICIPANT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_PARENTAL"
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT"].questions["WHO_ENROLLING"].answers.hasOption("ENROLLING_CHILD")""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_SELF",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "ACTIVITY_INSTANCE_CREATION",
         "activityCode": "ABOUT_PATIENT",
       },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT"].questions["ENROLLING_MYSELF_DIAGNOSED"].answers.hasOption("ENROLLING_MYSELF_DIAGNOSED_MYSELF")""",
       "maxOccurrencesPerUser": 1,
       "dispatchToHousekeeping": false,
       "order": 1
      },
      {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_SELF",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "ABOUT_PATIENT_WHO_ENROLLING_HIDDEN"
             }
           }
         ]
       },
       "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT"].questions["ENROLLING_MYSELF_DIAGNOSED"].answers.hasOption("ENROLLING_MYSELF_DIAGNOSED_MYSELF")""",
       "dispatchToHousekeeping": false,
       "order": 2
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_SELF",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "ACTIVITY_INSTANCE_CREATION",
         "activityCode": "ABOUT_HEALTHY",
       },

       "preconditionExpr": """!(user.studies["singular"].forms["ADD_PARTICIPANT"].questions["ENROLLING_MYSELF_DIAGNOSED"].answers.hasOption("ENROLLING_MYSELF_DIAGNOSED_MYSELF"))""",
       "maxOccurrencesPerUser": 1,
       "dispatchToHousekeeping": false,
       "order": 3
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_SELF",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "ABOUT_HEALTHY_WHO_ENROLLING_HIDDEN"
             }
           }
         ]
       },
       "preconditionExpr": """!(user.studies["singular"].forms["ADD_PARTICIPANT"].questions["ENROLLING_MYSELF_DIAGNOSED"].answers.hasOption("ENROLLING_MYSELF_DIAGNOSED_MYSELF"))""",
       "dispatchToHousekeeping": false,
       "order": 4
    }
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_PARENTAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "CONSENT_ASSENT"
      },
      "preconditionExpr": """user.studies["singular"].forms["ADD_PARTICIPANT"].questions["ADD_PARTICIPANT_INCAPACITATED"].answers.hasTrue()""",
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_ASSENT",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ABOUT_PATIENT"
      },
      "preconditionExpr": """
        user.studies["singular"].forms["ADD_PARTICIPANT"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("ENROLLING_CHILD_DIAGNOSED_MY_CHILD")
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 1
    },
    {
      "trigger": {
        "type": "ACTIVITY_STATUS",
        "activityCode": "CONSENT_PARENTAL",
        "statusType": "COMPLETE"
      },
      "action": {
        "type": "ACTIVITY_INSTANCE_CREATION",
        "activityCode": "ABOUT_PATIENT"
      },
      "preconditionExpr": """
        !(user.studies["singular"].forms["CONSENT_ASSENT"].hasInstance())
        && user.studies["singular"].forms["ADD_PARTICIPANT"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("ENROLLING_CHILD_DIAGNOSED_MY_CHILD")
      """,
      "maxOccurrencesPerUser": 1,
      "dispatchToHousekeeping": false,
      "order": 2
    },
    {
     "trigger": {
       "type": "ACTIVITY_STATUS",
       "activityCode": "CONSENT_PARENTAL",
       "statusType": "COMPLETE"
     },
     "action": {
       "type": "COPY_ANSWER",
       "copyConfigPairs": [
         {
           "source": {
             "type": "ANSWER",
             "questionStableId": "WHO_ENROLLING"
           },
           "target": {
             "type": "ANSWER",
             "questionStableId": "ABOUT_PATIENT_WHO_ENROLLING_HIDDEN"
           }
         }
       ]
     },
     "preconditionExpr": """
       !(user.studies["singular"].forms["CONSENT_ASSENT"].hasInstance())
       && user.studies["singular"].forms["ADD_PARTICIPANT"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("ENROLLING_CHILD_DIAGNOSED_MY_CHILD")
     """,
     "dispatchToHousekeeping": false,
     "order": 3
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_PARENTAL",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "ACTIVITY_INSTANCE_CREATION",
         "activityCode": "ABOUT_HEALTHY",
       },
       # If there's already about-cancer instances, then don't create any more.
       # Only way to get release is through prequal normal registration, so no need to check add-child.
       "preconditionExpr": """
         !(user.studies["singular"].forms["CONSENT_ASSENT"].hasInstance())
         && !(user.studies["singular"].forms["ADD_PARTICIPANT"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("ENROLLING_CHILD_DIAGNOSED_MY_CHILD"))
       """,
       "maxOccurrencesPerUser": 1,
       "dispatchToHousekeeping": false,
       "order": 4
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_PARENTAL",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "ABOUT_HEALTHY_WHO_ENROLLING_HIDDEN"
             }
           }
         ]
       },
       "preconditionExpr": """
          !(user.studies["singular"].forms["CONSENT_ASSENT"].hasInstance())
          && !(user.studies["singular"].forms["ADD_PARTICIPANT"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("ENROLLING_CHILD_DIAGNOSED_MY_CHILD"))
        """,
       "dispatchToHousekeeping": false,
       "order": 5
    },
    {
     "trigger": {
       "type": "ACTIVITY_STATUS",
       "activityCode": "CONSENT_ASSENT",
       "statusType": "COMPLETE"
     },
     "action": {
       "type": "COPY_ANSWER",
       "copyConfigPairs": [
         {
           "source": {
             "type": "ANSWER",
             "questionStableId": "WHO_ENROLLING"
           },
           "target": {
             "type": "ANSWER",
             "questionStableId": "ABOUT_PATIENT_WHO_ENROLLING_HIDDEN"
           }
         }
       ]
     },
     "preconditionExpr": """
       user.studies["singular"].forms["ADD_PARTICIPANT"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("ENROLLING_CHILD_DIAGNOSED_MY_CHILD")
     """,
     "dispatchToHousekeeping": false,
     "order": 2
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_ASSENT",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "ACTIVITY_INSTANCE_CREATION",
         "activityCode": "ABOUT_HEALTHY",
       },
       # If there's already about-cancer instances, then don't create any more.
       # Only way to get release is through prequal normal registration, so no need to check add-child.
       "preconditionExpr": """
         !(user.studies["singular"].forms["ADD_PARTICIPANT"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("ENROLLING_CHILD_DIAGNOSED_MY_CHILD"))
       """,
       "maxOccurrencesPerUser": 1,
       "dispatchToHousekeeping": false,
       "order": 3
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "CONSENT_ASSENT",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "ABOUT_HEALTHY_WHO_ENROLLING_HIDDEN"
             }
           }
         ]
       },
       "preconditionExpr": """
          !(user.studies["singular"].forms["ADD_PARTICIPANT"].questions["ENROLLING_CHILD_DIAGNOSED"].answers.hasOption("ENROLLING_CHILD_DIAGNOSED_MY_CHILD"))
        """,
       "dispatchToHousekeeping": false,
       "order": 4
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "ABOUT_PATIENT",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "ACTIVITY_INSTANCE_CREATION",
         "activityCode": "MEDICAL_RECORD_RELEASE",
       },
       "preconditionExpr": true,
       "maxOccurrencesPerUser": 1,
       "dispatchToHousekeeping": false,
       "order": 1
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "ABOUT_PATIENT",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "MRR_WHO_ENROLLING_COPY"
             }
           }
         ]
       },
       "preconditionExpr": true,
       "dispatchToHousekeeping": false,
       "order": 2
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "MEDICAL_RECORD_FILE_UPLOAD",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "ACTIVITY_INSTANCE_CREATION",
         "activityCode": "PATIENT_SURVEY",
       },
       # If there's already about-cancer instances, then don't create any more.
       # Only way to get release is through prequal normal registration, so no need to check add-child.
       "preconditionExpr": true,
       "maxOccurrencesPerUser": 1,
       "dispatchToHousekeeping": false,
       "order": 1
    },
    {
       "trigger": {
         "type": "ACTIVITY_STATUS",
         "activityCode": "MEDICAL_RECORD_FILE_UPLOAD",
         "statusType": "COMPLETE"
       },
       "action": {
         "type": "COPY_ANSWER",
         "copyConfigPairs": [
           {
             "source": {
               "type": "ANSWER",
               "questionStableId": "WHO_ENROLLING"
             },
             "target": {
               "type": "ANSWER",
               "questionStableId": "PATIENT_SURVEY_WHO_ENROLLING_HIDDEN"
             }
           }
         ]
       },
       "preconditionExpr": true,
       "dispatchToHousekeeping": false,
       "order": 2
    }
  ]
}
