version: 2.1

setup: true

orbs:
  path-filtering: circleci/path-filtering@0.1.1

parameters:
  on_demand:
    type: boolean
    default: false
  project:
    type: enum
    enum: ["dss", "dsm","api-docs", "nothing"]
    default: "dss"

workflows:
  conditional-workflow:
    jobs:
      - path-filtering/filter:
          base-revision: DSMMavenRefactor
          config-path: .circleci/main-config.yml
          mapping: |
            pepper-apis/.* action "build-test"
            pepper-apis/pom.xml "dss" true
            pepper-apis/(dss-.*)|(ddp-.*)|(pex-antlr)|(housekeeping)|(studybuilder-cli)/.* "dss" true
            pepper-apis/(dsm-.*)|(ddp-.*)/.* "dsm" true
            pepper-apis/docs/.* api-docs true
          filters:
            branches:
              only:
                - DSMMavenRefactor-build
